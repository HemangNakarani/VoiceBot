<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <input id="sessionId" type="text" placeholder="Add unique Username" />
    <button id="btnGiveCommand">Give Voice Command!</button>
    <br /><br />
    <span id="message"></span>
    <br /><br />
    <pre id="response-text"></pre>

    <script>
      var sessionId = document.querySelector("#sessionId");
      var message = document.querySelector("#message");
      var resposeText = document.querySelector("#response-text");

      async function fetchResponse(bodyObject) {
        return fetch("/api/v1", {
          method: "POST",
          body: JSON.stringify(bodyObject),
          headers: {
            "Content-type": "application/json; charset=UTF-8",
          },
        }).then((response) => response.json());
      }

      var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;

      //Not Supported in Safari - var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;
      //var grammar = "#JSGF V1.0;";

      var recognition = new SpeechRecognition();

      //   var speechRecognitionList = new SpeechGrammarList();
      //   speechRecognitionList.addFromString(grammar, 1);
      //   recognition.grammars = speechRecognitionList;

      recognition.lang = "en-US";
      recognition.interimResults = false;

      recognition.onaudiostart = function () {
        message.textContent = "Listening ...";
      };

      recognition.onresult = function (event) {
        var last = event.results.length - 1;
        var command = event.results[last][0].transcript;

        message.textContent = "Voice Input: " + command + ".";

        fetchResponse({
          sessionId: sessionId.value,
          query: command,
        }).then((data) => {
          resposeText.innerHTML = JSON.stringify(data.message, null, 2);
        });
      };

      recognition.onspeechend = function () {
        recognition.stop();
      };

      recognition.onerror = function (event) {
        console.log(event);
        message.textContent = "Error occurred in recognition: " + event.error;
      };

      document
        .querySelector("#btnGiveCommand")
        .addEventListener("click", function () {
          recognition.start();
        });
    </script>
  </body>
</html>
